<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Popstar Preview — Approved Sellers</title>
  <style>
    body { font-family: system-ui, -apple-system, Arial, sans-serif; margin: 0; padding: 24px; }
    .wrap { max-width: 1100px; margin: 0 auto; }
    h1 { margin: 0 0 12px; }
    .meta { opacity: 0.7; margin-bottom: 18px; }
    .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(260px, 1fr)); gap: 14px; }
    .card { border: 1px solid rgba(0,0,0,0.12); border-radius: 14px; padding: 14px; background: #fff; }
    .top { display: flex; gap: 10px; align-items: center; margin-bottom: 10px; }
    .avatar { width: 48px; height: 48px; border-radius: 12px; background: rgba(0,0,0,0.06); overflow: hidden; flex: 0 0 auto; }
    .avatar img { width: 100%; height: 100%; object-fit: cover; display: block; }
    .name { font-weight: 700; line-height: 1.1; }
    .user { opacity: 0.7; font-size: 0.92rem; }
    .bio { margin: 10px 0 12px; opacity: 0.9; display: -webkit-box; -webkit-line-clamp: 3; -webkit-box-orient: vertical; overflow: hidden; }
    .pills { display: flex; flex-wrap: wrap; gap: 6px; align-items: center; }
    .pill { font-size: 12px; padding: 5px 9px; border-radius: 999px; border: 1px solid rgba(0,0,0,0.12); }
    .row { display:flex; justify-content: space-between; align-items: center; gap: 10px; }
    .btn { text-decoration: none; font-weight: 700; }
    .err { color: #b00020; white-space: pre-wrap; }
    .ok { color: #0a7a24; }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Popstar Preview</h1>
    <div class="meta">Shows approved rows from seller_profiles (Option 1 dynamic rendering).</div>
    <div id="status" class="meta"></div>
    <div id="grid" class="grid"></div>
    <div id="error" class="err"></div>
  </div>

  <script>
    const SUPABASE_URL = "REPLACE_WITH_YOUR_SUPABASE_URL";
    const SUPABASE_ANON_KEY = "REPLACE_WITH_YOUR_SUPABASE_ANON_KEY";

    async function fetchApproved() {
      const statusEl = document.getElementById("status");
      const errEl = document.getElementById("error");
      const gridEl = document.getElementById("grid");

      statusEl.textContent = "Loading…";
      errEl.textContent = "";
      gridEl.innerHTML = "";

      const url = `${SUPABASE_URL}/rest/v1/seller_profiles?select=id,shop_name,depop_username,shop_url,bio,city,state,genre,subcategories,avatar_url,created_at,status&status=eq.approved&order=created_at.desc&limit=60`;

      const res = await fetch(url, {
        headers: {
          apikey: SUPABASE_ANON_KEY,
          Authorization: `Bearer ${SUPABASE_ANON_KEY}`,
        },
      });

      if (!res.ok) {
        const text = await res.text();
        throw new Error(`Fetch failed (${res.status}): ${text}`);
      }

      const rows = await res.json();
      statusEl.textContent = `Loaded: ${rows.length} approved seller(s)`;

      for (const r of rows) {
        const card = document.createElement("div");
        card.className = "card";

        const avatar = r.avatar_url
          ? `<div class="avatar"><img src="${escapeHtml(r.avatar_url)}" alt=""></div>`
          : `<div class="avatar"></div>`;

        const loc = [r.city, r.state].filter(Boolean).join(", ");
        const subs = Array.isArray(r.subcategories) ? r.subcategories : [];

        card.innerHTML = `
          <div class="row">
            <div class="top">
              ${avatar}
              <div>
                <div class="name">${escapeHtml(r.shop_name || "")}</div>
                <div class="user">@${escapeHtml(r.depop_username || "")}${loc ? ` • ${escapeHtml(loc)}` : ""}</div>
              </div>
            </div>
            <a class="btn" href="${escapeHtml(r.shop_url)}" target="_blank" rel="noopener">view shop →</a>
          </div>

          <div class="bio">${escapeHtml(r.bio || "")}</div>

          <div class="pills">
            <span class="pill">${escapeHtml(r.genre || "")}</span>
            ${subs.map(s => `<span class="pill">${escapeHtml(s)}</span>`).join("")}
          </div>
        `;

        gridEl.appendChild(card);
      }
    }

    function escapeHtml(str) {
      return String(str)
        .replaceAll("&", "&amp;")
        .replaceAll("<", "&lt;")
        .replaceAll(">", "&gt;")
        .replaceAll('"', "&quot;")
        .replaceAll("'", "&#039;");
    }

    fetchApproved().catch(e => {
      document.getElementById("status").textContent = "";
      document.getElementById("error").textContent = e.message;
    });
  </script>
</body>
</html>
