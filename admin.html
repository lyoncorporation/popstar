<!doctype html>
<html>
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>popstar admin</title>
<style>
body{font-family:system-ui;margin:0;padding:20px;background:#f5f5f2}
.card{background:#fff;border:2px solid #000;border-radius:16px;padding:16px;margin-bottom:16px}
button{padding:8px 12px;border:2px solid #000;border-radius:12px;font-weight:700;cursor:pointer}
.ok{background:#8ACE00}
</style>
</head>
<body>

<div id="authCard" class="card">
<h3>admin login</h3>
<input id="email" type="email" placeholder="email"/><br/><br/>
<input id="password" type="password" placeholder="password"/><br/><br/>
<button id="loginBtn" class="ok">log in</button>
<div id="status" style="margin-top:10px;font-size:12px;"></div>
</div>

<div id="app" style="display:none;">
<div class="card">
<h3>pending boosts</h3>
<div id="boostList"></div>
</div>
</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
const supa = window.supabase.createClient("https://otvznctmwutbwulbhfvx.supabase.co", "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im90dnpuY3Rtd3V0Ynd1bGJoZnZ4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzIwNzc3MzcsImV4cCI6MjA4NzY1MzczN30.txShYO4rqLSMHeLuN_2rzRmvXZK3mnPsaabFtTa8Ph8");
const $ = id => document.getElementById(id);

async function load() {
  const { data, error } = await supa
    .from("boost_purchases")
    .select("*")
    .in("status", ["pending","queued"])
    .order("created_at", { ascending: true });

  const container = $("boostList");
  container.innerHTML = "";

  if (error) {
    container.innerHTML = "error loading boosts: " + error.message;
    return;
  }

  data.forEach(b => {
    const div = document.createElement("div");
    div.className = "card";
    div.innerHTML = `
      <div><strong>${b.placement || ""}</strong> Â· ${b.duration_hours || ""}h</div>
      <div>status: ${b.status}</div>
      <button class="ok" data-id="${b.id}">approve</button>
    `;
    container.appendChild(div);
  });
}

async function approveBoost(id) {
  const { error } = await supa.rpc("approve_boost", { p_boost_id: id });
  if (error) {
    alert("approve failed: " + error.message);
    return;
  }
  load();
}

document.addEventListener("click", e => {
  if (e.target.dataset.id) {
    approveBoost(e.target.dataset.id);
  }
});

$("loginBtn").addEventListener("click", async () => {
  const email = $("email").value.trim();
  const password = $("password").value.trim();
  const { error } = await supa.auth.signInWithPassword({ email, password });
  if (error) {
    $("status").textContent = error.message;
    return;
  }
  location.reload();
});

(async () => {
  const { data: { session } } = await supa.auth.getSession();
  if (session) {
    $("authCard").style.display = "none";
    $("app").style.display = "block";
    load();
  }
})();
</script>

</body>
</html>
